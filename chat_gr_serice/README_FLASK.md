# Flaskç‰ˆæ™ºèƒ½å¯¹è¯ç³»ç»Ÿ

åŸºäºFlaskçš„Webåº”ç”¨ï¼Œä½¿ç”¨åŸç”ŸHTML/CSS/JavaScriptï¼Œä¸ä¾èµ–Gradioã€‚

## ç‰¹æ€§

- âœ… **è½»é‡çº§**: åªéœ€è¦Flaskï¼Œæ— Gradioä¾èµ–
- âœ… **ç°ä»£åŒ–ç•Œé¢**: ç¾è§‚çš„æ¸å˜è‰²è®¾è®¡
- âœ… **å“åº”å¼**: é€‚é…å„ç§å±å¹•å°ºå¯¸
- âœ… **å®Œæ•´åŠŸèƒ½**: ä¸Gradioç‰ˆæœ¬åŠŸèƒ½ç›¸åŒ
- âœ… **APIæ¥å£**: RESTful APIè®¾è®¡
- âœ… **æ˜“äºå®šåˆ¶**: çº¯HTML/CSS/JSï¼Œæ–¹ä¾¿ä¿®æ”¹

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
./start_flask.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
pip3 install Flask Werkzeug

# 2. å¯åŠ¨åº”ç”¨
python3 flask_app.py

# 3. è®¿é—®åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€ http://localhost:5000
```

## é¡¹ç›®ç»“æ„

```
chat_gr_service/
â”œâ”€â”€ flask_app.py              # Flaskä¸»åº”ç”¨
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html            # å‰ç«¯é¡µé¢
â”œâ”€â”€ workflow_mock.py          # å·¥ä½œæµæœåŠ¡ï¼ˆä¸Gradioç‰ˆæœ¬å…±äº«ï¼‰
â”œâ”€â”€ session_manager.py        # ä¼šè¯ç®¡ç†ï¼ˆä¸Gradioç‰ˆæœ¬å…±äº«ï¼‰
â”œâ”€â”€ async_processor.py        # å¼‚æ­¥å¤„ç†ï¼ˆä¸Gradioç‰ˆæœ¬å…±äº«ï¼‰
â””â”€â”€ start_flask.sh            # å¯åŠ¨è„šæœ¬
```

## APIæ¥å£

### 1. åˆ›å»º/è·å–ä¼šè¯

```
GET /api/session
POST /api/session
```

**å“åº”**:
```json
{
  "success": true,
  "session_id": "session_1_xxx",
  "message_count": 0
}
```

### 2. è·å–æ¶ˆæ¯

```
GET /api/messages
```

**å“åº”**:
```json
{
  "success": true,
  "messages": [
    {
      "role": "user",
      "content": "åˆ†æé”€å”®æ•°æ®",
      "timestamp": "2025-02-09T12:00:00"
    },
    {
      "role": "assistant",
      "content": "åˆ†æå®Œæˆ...",
      "timestamp": "2025-02-09T12:00:02",
      "visualization_url": "https://..."
    }
  ]
}
```

### 3. å‘é€æ¶ˆæ¯

```
POST /api/send
Content-Type: application/json

{
  "message": "åˆ†æé”€å”®æ•°æ®"
}
```

**å“åº”**:
```json
{
  "success": true,
  "run_id": "run_1_xxx",
  "message": "æ¶ˆæ¯å·²å‘é€ï¼Œå·¥ä½œæµæ­£åœ¨å¤„ç†"
}
```

### 4. åˆ·æ–°çŠ¶æ€

```
POST /api/refresh
```

**å“åº”**:
```json
{
  "success": true,
  "messages": [...],
  "reference_info": "https://...",
  "session_id": "session_1_xxx",
  "waiting_for_input": false,
  "current_run_id": "run_1_xxx"
}
```

### 5. æ¸…ç©ºå¯¹è¯

```
POST /api/clear
```

**å“åº”**:
```json
{
  "success": true,
  "session_id": "session_2_xxx",
  "message": "å¯¹è¯å·²æ¸…ç©º"
}
```

### 6. ç³»ç»ŸçŠ¶æ€

```
GET /api/status
```

**å“åº”**:
```json
{
  "success": true,
  "active_sessions": 1,
  "active_tasks": 0
}
```

## å‰ç«¯ç•Œé¢

### ä¸»è¦ç»„ä»¶

1. **å¯¹è¯åŒº**: æ˜¾ç¤ºç”¨æˆ·å’ŒåŠ©æ‰‹çš„å¯¹è¯
2. **è¾“å…¥æ¡†**: è¾“å…¥æ¶ˆæ¯
3. **æ§åˆ¶æŒ‰é’®**:
   - å‘é€
   - æ¸…ç©ºå¯¹è¯
   - æ–°å»ºä¼šè¯
   - åˆ·æ–°çŠ¶æ€
4. **ä¿¡æ¯é¢æ¿**:
   - å‚è€ƒä¿¡æ¯ï¼ˆå¯è§†åŒ–é“¾æ¥ï¼‰
   - ä¼šè¯ä¿¡æ¯
   - å·¥ä½œæµçŠ¶æ€

### ç•Œé¢ç‰¹ç‚¹

- ğŸ¨ **æ¸å˜è‰²è®¾è®¡**: ç´«è‰²æ¸å˜ä¸»é¢˜
- ğŸ’¬ **æ°”æ³¡å¼å¯¹è¯**: åŒºåˆ†ç”¨æˆ·å’ŒåŠ©æ‰‹æ¶ˆæ¯
- ğŸ”„ **å®æ—¶æ›´æ–°**: ç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°çŠ¶æ€
- ğŸ“Š **å¯è§†åŒ–é“¾æ¥**: ç›´æ¥è®¿é—®å·¥ä½œæµç”Ÿæˆçš„å›¾è¡¨
- âš¡ **åŠ¨ç”»æ•ˆæœ**: æµç•…çš„æ¶ˆæ¯æ»‘å…¥åŠ¨ç”»

## ä½¿ç”¨ç¤ºä¾‹

### 1. ç®€å•å¯¹è¯

```
1. è¾“å…¥: "å¸®æˆ‘åˆ†æé”€å”®æ•°æ®"
2. ç‚¹å‡»"å‘é€"
3. ç­‰å¾…2-3ç§’
4. ç‚¹å‡»"ğŸ”„ åˆ·æ–°çŠ¶æ€"
5. æŸ¥çœ‹åŠ©æ‰‹å›å¤å’Œå¯è§†åŒ–é“¾æ¥
```

### 2. ä¸­æ–­-é‡å¯æµç¨‹

```
1. è¾“å…¥: "åˆ†æç”¨æˆ·è¡Œä¸º"
2. ç‚¹å‡»"å‘é€"
3. ç‚¹å‡»"åˆ·æ–°"
4. æŸ¥çœ‹ä¸­æ–­æç¤º: "éœ€è¦æ›´å¤šä¿¡æ¯"
5. è¾“å…¥: "æœ€è¿‘ä¸€å‘¨çš„æ•°æ®"
6. ç‚¹å‡»"å‘é€"
7. ç‚¹å‡»"åˆ·æ–°"
8. æŸ¥çœ‹æœ€ç»ˆç»“æœ
```

## å®šåˆ¶åŒ–

### ä¿®æ”¹é¢œè‰²ä¸»é¢˜

ç¼–è¾‘ `templates/index.html` ä¸­çš„CSS:

```css
/* ä¿®æ”¹æ¸å˜è‰² */
background: linear-gradient(135deg, #ä½ çš„é¢œè‰²1 0%, #ä½ çš„é¢œè‰²2 100%);
```

### ä¿®æ”¹ç•Œé¢å¸ƒå±€

ç¼–è¾‘ `templates/index.html`:

```html
<!-- è°ƒæ•´å·¦å³æ¯”ä¾‹ -->
<div class="main-content" style="grid-template-columns: 3fr 1fr;">
```

### æ·»åŠ æ–°åŠŸèƒ½

ç¼–è¾‘ `flask_app.py` æ·»åŠ æ–°è·¯ç”±:

```python
@app.route('/api/your-feature', methods=['POST'])
def your_feature():
    # ä½ çš„é€»è¾‘
    return jsonify({'success': True, ...})
```

## ä¸Gradioç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | Flaskç‰ˆ | Gradioç‰ˆ |
|------|---------|----------|
| ä¾èµ– | Flask (è½»é‡) | Gradio (é‡é‡çº§) |
| ç•Œé¢ | è‡ªå®šä¹‰HTML/CSS | Gradioç»„ä»¶ |
| å®šåˆ¶æ€§ | â­â­â­â­â­ | â­â­â­ |
| åŠŸèƒ½ | å®Œæ•´ | å®Œæ•´ |
| æ€§èƒ½ | æ›´å¿« | è¾ƒæ…¢ |
| æ–‡ä»¶å¤§å° | æ›´å° | æ›´å¤§ |
| API | RESTful | æœ‰é™ |

## éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
python3 flask_app.py
# è®¿é—® http://localhost:5000
```

### ç”Ÿäº§ç¯å¢ƒ

ä½¿ç”¨Gunicorn:

```bash
# å®‰è£…gunicorn
pip3 install gunicorn

# å¯åŠ¨
gunicorn -w 4 -b 0.0.0.0:5000 flask_app:app
```

### Dockeréƒ¨ç½²

```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements_flask.txt .
RUN pip install -r requirements_flask.txt
COPY . .
CMD ["python", "flask_app.py"]
EXPOSE 5000
```

## é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `flask_app.py`:

```python
app.run(host='0.0.0.0', port=8080)  # æ”¹ä¸º8080
```

### å¯ç”¨è°ƒè¯•æ¨¡å¼

```python
app.run(debug=True)  # å¼€å‘ç¯å¢ƒ
app.run(debug=False)  # ç”Ÿäº§ç¯å¢ƒ
```

### æ·»åŠ å¯†é’¥

```python
app.config['SECRET_KEY'] = 'your-secret-key-here'
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5000
# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜2: æ¨¡æ¿æœªæ‰¾åˆ°

ç¡®ä¿ `templates/index.html` æ–‡ä»¶å­˜åœ¨ä¸”è·¯å¾„æ­£ç¡®

### é—®é¢˜3: APIè¿”å›404

æ£€æŸ¥è·¯ç”±æ˜¯å¦æ­£ç¡®å®šä¹‰ï¼ŒURLæ˜¯å¦æ­£ç¡®

## æµ‹è¯•

### æµ‹è¯•API

```bash
# åˆ›å»ºä¼šè¯
curl http://localhost:5000/api/session -X POST

# è·å–æ¶ˆæ¯
curl http://localhost:5000/api/messages

# å‘é€æ¶ˆæ¯
curl http://localhost:5000/api/send -X POST \
  -H "Content-Type: application/json" \
  -d '{"message":"æµ‹è¯•æ¶ˆæ¯"}'
```

### æµ‹è¯•å‰ç«¯

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5000`
2. è¾“å…¥æµ‹è¯•æ¶ˆæ¯
3. ç‚¹å‡»åˆ·æ–°æŒ‰é’®
4. æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½

## ä¼˜åŠ¿

1. **è½»é‡çº§**: åªéœ€è¦Flaskï¼Œå¯åŠ¨å¿«
2. **çµæ´»**: å®Œå…¨æ§åˆ¶å‰ç«¯å’Œåç«¯
3. **API**: RESTfulæ¥å£ï¼Œæ˜“äºé›†æˆ
4. **ç¾è§‚**: ç°ä»£åŒ–UIè®¾è®¡
5. **æ— ä¾èµ–**: ä¸éœ€è¦Gradio

## é€‚ç”¨åœºæ™¯

- âœ… éœ€è¦è‡ªå®šä¹‰ç•Œé¢
- âœ… éœ€è¦APIæ¥å£
- âœ… éœ€è¦è½»é‡çº§éƒ¨ç½²
- âœ… éœ€è¦é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- âœ… ä¸æƒ³ä½¿ç”¨Gradio

## åç»­æ”¹è¿›

- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯
- [ ] æ·»åŠ WebSocketå®æ—¶æ¨é€
- [ ] æ·»åŠ æ•°æ®åº“å­˜å‚¨
- [ ] æ·»åŠ æ—¥å¿—ç³»ç»Ÿ
- [ ] æ·»åŠ ç›‘æ§é¢æ¿
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

## License

MIT License
